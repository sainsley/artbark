<link href='http://fonts.googleapis.com/css?family=Cabin+Sketch' rel='stylesheet' type='text/css'>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ArtBark</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="external_js/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
		<style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
		<link href="external_js/fontawesome/css/font-awesome.css" rel="stylesheet">
    <link href="external_js/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" style="padding-top: 20px; font-size: 48px;">ArtBark</a>
          <div class="nav-collapse collapse">
            <p class="navbar-text pull-right">
              Logged in as <a href="#" class="navbar-link">Yourself</a>
            </p>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span8">
          <div id="image-holder" class="hero-unit">
						<div id="title-bar">
							<div id="by-line" class="span5">
								<h2 id="title">"Marilyn Diptych"</h2>
								<p id="author">Andy</p>
							</div>
							<div id="rating" class="span7">
								<img id="star-1" class="star" src="graphics/star.png" data-idx="1"></img>
								<img id="star-2" class="star" src="graphics/star.png" data-idx="2"></img>
								<img id="star-3" class="star" src="graphics/star.png" data-idx="3"></img>
								<img id="star-4" class="star" src="graphics/star.png" data-idx="4"></img>
								<img id="star-5" class="star" src="graphics/star.png" data-idx="5"></img>
							</div>
						</div>
            <img id="art" src="graphics/warhol.jpg"></img>
						<div id="anotate" class="popover fade right in" style="display: block;">
							<div class="arrow"></div>
							<h3 class="popover-title">Annotate this work</h3>
							<div class="popover-content">
								<textarea id="annotation-entry" class="comment-box span12" rows="5"></textarea>
								<button class="annotation post btn btn-info span12" style="margin-left: 0;" data-entry="#annotation-entry">Post</button>
							</div>
							<i id='temp-pin' class='icon-map-marker pin' style="color: #ebebeb; display: none"></i>
						</div>
          </div>
        </div><!--/span-->
        <div class="span4">
          <div id="comments-holder" class="well sidebar-nav">
						<h3 class="nav-header" style="font-size: 16px;">Comment</h3>
            <ul id="comments"class="nav nav-list">
				<li class="comment well tag-happy group-friends">Test comment with tag happy and group friends</li>
				<li class="comment well tag-sad group-mentors">Test comment with tag sad and group mentors</li>
				<li class="comment well tag-pastoral group-mentors">Test comment with tag pastoral and group mentors</li>
            </ul>
						<div class="span1"></div>
						<textarea id="main-entry" class="comment-box span10" rows="5"></textarea>
						<div class="span1"></div>
						<button class="comment post btn btn-info span10" style="margin-left: 0;" data-entry="#main-entry">Post</button>
          </div><!--/.well -->

			<div id="tags-holder" class="well sidebar-nav userType-artist">
				<h3 class="nav-header" style="font-size: 16px;">Filter by tag</h3>
				<div class="btn-group nav-content" id="btn-group-tags" data-toggle="buttons-checkbox">
				  <!--<button type="button" class="btn btn-primary">Tag1</button>
				  <button type="button" class="btn btn-primary">Tag2</button>
				  <button type="button" class="btn btn-primary">Tag3</button> -->
				</div>
			</div>

		  	<div id="groups-holder" class="well sidebar-nav userType-artist">
				<h3 class="nav-header" style="font-size: 16px;">Filter by group</h3>

				<div class="btn-group nav-content" id="btn-group-groups" data-toggle="buttons-checkbox">
				  <!--<button type="button" class="btn btn-primary">Group1</button>
				  <button type="button" class="btn btn-primary">Group2</button>
				  <button type="button" class="btn btn-primary">Group3</button> -->
				</div>
			</div>
        </div><!--/span-->
      </div><!--/row-->

      <hr>

      <footer>
        <p>&copy; 6.813 User Interface Design : GR4</p>
      </footer>

    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="external_js/jquery.js"></script>
	<script src="external_js/jquery-ui-1.10.0.custom.min.js"></script>
    <script src="external_js/bootstrap/js/bootstrap.js"></script>
		<script>
			// for keeping track of temp pen cursor 
			var pinX, pinY;
		
			$.extend({
				getUrlVars : function() {
					var vars = [], hash;
					var hashes = window.location.href.slice(
							window.location.href.indexOf('?') + 1).split('&');
					for ( var i = 0; i < hashes.length; i++) {
						hash = hashes[i].split('=');
						vars.push(hash[0]);
						vars[hash[0]] = hash[1];
					}
					return vars;
				},
				getUrlVar : function(name) {
					return $.getUrlVars()[name];
				}
			});
	
			function getSettingsFromUrl(){
				if($.getUrlVar('tags')) 
				{
					artistDefinedTags = ($.getUrlVar('tags')).split(',');
					//trialsPerUser = (parseInt($.getUrlVar('trialsPerUser')));
					
				}

				if($.getUrlVar('groups')) 
				{
					artistDefinedGroups = ($.getUrlVar('groups')).split(',');
					//trialsPerUser = (parseInt($.getUrlVar('trialsPerUser')));
				}

				if($.getUrlVar('userType')) 
				{
					userType = $.getUrlVar('userType');
					//trialsPerUser = (parseInt($.getUrlVar('trialsPerUser')));
					
				}
			};
			
			var artistDefinedTags = new Array("pastoral","dark");
			var artistDefinedGroups = new Array("Mentors","Friends");
			var userType = "artist";

			var filters = new Object();

			var selectedAnnotation;
			var expandedAnnotation;
			
			//
			// Commenting
			//
			add_comment = function(body) {
				var list_item = '<li class="comment well">'+body+'</li>';
				$("#comments").append(list_item);
			}

			add_button_tag = function(tagName) {
				var tagId = "tag-"+tagName; 
				var newButton = '<button type="button" class="btn btn-primary btn-filter" id="' + tagId + '">#' + tagName + '</button>';
				$("#btn-group-tags").append(newButton);
				console.log($("#"+tagId));
				$("#"+tagId)[0].addEventListener("click",onClickFilterButton,false);
				$("#"+tagId)[0].className += " active";
				filters[tagId] = 1;
				
			}

			add_group_tag = function(groupName) {
				var groupId = "group-" + groupName;
				var newButton = '<button type="button" class="btn btn-primary btn-filter" id="' + groupId + '">' + groupName + '</button>';
				$("#btn-group-groups").append(newButton);
				$("#"+groupId)[0].addEventListener("click",onClickFilterButton,false);
				$("#"+groupId)[0].className += " active";
				filters[groupId] = 1;
			}

			applyfilters = function(filterIds)
			{
				console.log("applying filters");

				// TODO(for sainsley from amy): add your own filtering behavior here 

				$.each( filters, function( key, value ) {
					console.log(key + ", " + value);
			 		if(value==0 && $("."+key).length > 0)
				 	{
				 		console.log("hidden");
				 		for (var i=0;i<$("."+key).length;i++)
				 		{
				 			console.log($("."+key)[i]);
				 			$("."+key)[i].style.visibility = "hidden";
				 		}
				 	}

				});

				$.each( filters, function( key, value ) {
					console.log(key + ", " + value);
				 	if(value==1 && $("."+key).length > 0)
				 	{
				 		console.log("visible");
				 		for (var i=0;i<$("."+key).length;i++)
				 		{
				 			console.log($("."+key)[i]);
				 			$("."+key)[i].style.visibility = "visible";
				 		}
				 		
				 	}

				});

			}


			initFilters = function()
			{
				// Add filtering options for tags and groups
				for(var i=0;i<artistDefinedTags.length;i++)
				{
					//var tagName = artistDefinedTags[i];
					//
					add_button_tag(artistDefinedTags[i]);
					
				}

				for(var i=0;i<artistDefinedGroups.length;i++)
				{
					add_group_tag(artistDefinedGroups[i]);
				}
			}




			onClickFilterButton = function(event)
			{
				console.log($(this)[0].className);
				console.log(event);

				var filterName = $(this)[0].id;

				//var filterButtons = $(".btn-filter");

				/*for(var i=0;i<filterButtons.length;i++)
				{
					if((filterButtons[i].className).indexOf("active")!=-1)
					{
						filters.push(filterButtons[i].id);
					}
				} */
				
				// If button is raised (not active)
				if(filters[filterName]==0)
				{
					filters[filterName] = 1;
					console.log("pressed")
					//filters.splice(filters.indexOf($(this)[0].id),1);
					//filters[filterName] = 0;
				}
				else
				{
					console.log("unpressed")
					//filters.push($(this)[0].id);
					filters[filterName] = 0;
				}
				console.log(filters);
				applyfilters();
			}
		 	$(document).ready(function() {
				$('.nav-tabs').button();
				getSettingsFromUrl();
				initFilters();

				// Ghetto session control
				if(userType == "artist")
				{
					if($(".userType-commenter").length > 0)
					{
						$(".userType-commenter").style.visibility = "hidden";
					}
				}	
				else
				{
					$(".userType-artist").style.visibility = "hidden";
				}

			
				$('#anotate').hide();
				var pin_count = 0;
				//
				// Ratings feedback
				//
				$(".star").mouseover(function(event) {
					var id = $(this).data("idx");
					var rollover = "graphics/star-fill.png"
					for (var i = 1; i <= id; ++i) {
						$("#star-"+i).attr("src", rollover);
					}
				});
				
				$(".star").mouseout(function(event) {
					var id = $(this).data("idx");
					var original = "graphics/star.png"
					for (var i = 1; i <= id; ++i) {
						if($("#star-"+i).css("opacity") < 1.0) {
							$("#star-"+i).attr("src", original);
						}
					}
				});
				
				$(".star").click(function(event) {
					var id = $(this).data("idx");
					var filled = "graphics/star-fill.png"
					var empty = "graphics/star.png"
					for (var i = 1; i <= id; ++i) {
						$("#star-"+i).attr("src", filled);
						$("#star-"+i).css("opacity", 1.0);
					}
					for (var i = id+1; i <= 5; ++i) {
						$("#star-"+i).attr("src", empty);
						$("#star-"+i).css("opacity", 0.6);
					}
				});
				
				$(".comment.post").click(function(event) {
					var entry = $(this).data("entry");
					
					add_comment($(entry).val());
					$(entry).val('');
					//$('#anotate').hide();
				});
				
				$(".annotation.post").click(function(event) {
					$('#temp-pin').hide();
					add_pin();
					
					var entry = $(this).data("entry");
					var pin = $('#pin-' + String(pin_count-1));
					console.log($('#pin-' + String(pin_count-1)));
					console.log($('#anotate'));
					
					add_annotation(pin[0].offsetLeft, pin[0].offsetTop, $(this).data("entry"),pin_count-1);
					
					add_comment($(entry).val());
					$(entry).val('');
					$('#anotate').hide();
				});
				
				$("#art").click(function(event) {
					if(expandedAnnotation!=null) {
						expandedAnnotation[0].children[0].style.visibility = 'hidden';
					}
						
					$('#anotate').show();
					var offset = $('#anotate').height()/2;
					$('#anotate').offset({ top: event.pageY-offset+6, left: event.pageX+12});
					pinX = event.pageX-25/2;
					pinY = event.pageY-30;
					$('#temp-pin').show();
					$('#temp-pin').position({ top: 0, left: 0});
					$('#temp-pin').offset({ top: pinY, left: pinX});

					
					// TODO(sainsley): Hide pin on cancel
				});
				
				function onMouseEnterAnnotation(event)
				{
					// TODO(amy): highlight annotation icon on mouseover 
					//console.log("Highlighted annotation");
				}
				
				function onMouseLeaveAnnotation(event)
				{
					//selectedAnnotation = null;
					console.log("No selected annotation");
					//$(this).width(iconWidth*1.2);
					//$(this).css('width','120%');
				}
				
				add_pin = function() {
					var pin_id = "pin-"+pin_count;
					var pin = "<i id='"+pin_id+"' class='icon-map-marker pin'></i>";
					//addEvent(link, 'click', function () {alert('Hi'); });
					//$('body').append(pin);
					$('#image-holder').append(pin);
					$('#'+pin_id).offset({ top: pinY, left: pinX});
					//$('#div'+pin_id).offset({ top: event.pageY-30, left: event.pageX-25/2});
					$('#'+pin_id)[0].addEventListener("mouseover", onMouseEnterAnnotation, false);
					$('#'+pin_id)[0].addEventListener("mouseout", onMouseLeaveAnnotation, false);
					$('#'+pin_id)[0].addEventListener("click", onClickAnnotation, false);
					//$('#'+pin_id)[0].className += "pin";
					pin_count++;
				}
				
				add_annotation = function(x,y, body, pin_id_num) {
					
					var annotationBox = "<div id='comment-" + pin_id_num + "' class='comment well'>"+body+"</div>";
					$('#pin-' + pin_id_num).append(annotationBox);
					console.log("appending to pin");
					//console.log($("#pin-"+pin_id_num));
					
					//$("#comment-"+pin_id_num).offset({ top: event.pageY-30, left: event.pageX-25/2});
					$("#comment-"+pin_id_num)[0].style.visibility = 'hidden';
					
				}
				
				function onClickAnnotation(event)
				{
					//console.log($(this));
					//$(this).css('width','120%');
					//$('#anotate').show();
					//var offset = $('#anotate').height()/2;
					expandedAnnotation = $(this);
					$(this)[0].children[0].style.visibility = 'visible';
					//$('#anotate').offset({ top: event.pageY-offset, left: event.pageX+6});
				}
		 	});
		</script>
  </body>
</html>
